/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-12
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,n,a){return e.slice(n,a)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,n,a){var t=0;return{restrict:"A",scope:!0,compile:function(r,i){r.addClass("rn-carousel-slides");var u=r.find("li")[0].attributes["ng-repeat"],s=u.value.match(/^([^\s]+) in (.+)$/i),o=s[1],l=s[2],c=angular.isDefined(i.rnCarouselBuffered);if(c){var d="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";u.value=o+" in carouselItems"+d}return function(r,i,u){function s(){return 1>=r.totalIndex}function o(){return r.totalIndex>=F()-2}function d(){c&&r.$apply(function(){f(),m()})}function f(){if(c){var e=r.totalIndex-1,n=F()>0?F()-r.carouselBufferSize:Number.MAX_VALUE;r.carouselBufferStart,r.carouselBufferStart=Math.max(0,Math.min(e,n))}}function x(e){null===e&&(e=r.totalIndex);var n=null===b?Number.MAX_VALUE:F()-1;r.totalIndex=Math.max(0,Math.min(n,e))}function m(){if(c){var e=!1;if(o()&&(e=F()-1>r.totalIndex+1,!e&&angular.isDefined(u.rnCarouselNext))){var a=n(u.rnCarouselNext)(r,{index:r.totalIndex+1,item:r.carouselItems[r.carouselItems.length-1]});z.add("append",a)}if(s()&&(e=r.carouselBufferStart>0,!e&&angular.isDefined(u.rnCarouselPrev))){var t=n(u.rnCarouselPrev)(r,{index:0,item:r.carouselItems[0]});z.add("prepend",t)}}}function I(e,n){var a={};return a[e]=n,angular.forEach(L,function(t){a["-"+t.toLowerCase()+"-"+e]=n}),a}function p(e){return I("transform","translate3d("+e+"px,0,0)")}function v(){r.activeIndex=r.totalIndex-r.carouselBufferStart}function h(){var e=!1;return F(),c&&(r.totalIndex<r.carouselBufferStart?e=!0:r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1&&(e=!0),e&&f()),e}function g(e){x(null),e=h()||A===!0||e,w=(r.totalIndex-r.carouselBufferStart)*-b,e===!0?N.addClass("rn-carousel-noanimate").css(p(w)):N.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(p(w)),A=!1}t++;var C="rn-carousel-"+t,B=0,$=0,S=0,w=0,M=.1,b=null,A=!0,E=!1,N=i.wrap("<div id='"+C+"' class='rn-carousel-container'></div>"),y=N.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var z={add:function(e,n){n&&(angular.isObject(n.promise)?n.promise.then(function(n){n&&z[e](n)}):angular.isFunction(n.then)?n.then(function(n){n&&z[e](n)}):z[e](n))},append:function(e){angular.isArray(e)?r.carouselItems=r.carouselItems.concat(e):r.carouselItems.push(e),f()},prepend:function(e){A=!0;var n=1;angular.isArray(e)?(n=e.length,r.carouselItems=e.concat(r.carouselItems)):r.carouselItems.splice(0,0,e),x(r.totalIndex+n),r.$$phase||g()}},L=["webkit","moz"];if(c&&(r.carouselBufferSize=3,N[0].addEventListener("webkitTransitionEnd",d,!1),N[0].addEventListener("transitionend",d,!1),r.$watch("carouselBufferStart",function(){v(),g(!0)})),u.rnCarouselIndex){var D=n(u.rnCarouselIndex);angular.isFunction(D.assign)?(r.$watch("totalIndex",function(e){D.assign(r.$parent,e)}),r.$parent.$watch(D,function(e){x(e)})):isNaN(u.rnCarouselIndex)||x(parseInt(u.rnCarouselIndex,10))}if(r.$watch(l,function(e,n){e!==n&&(x(0),r.carouselBufferStart=0)}),r.$watch(l,function(e){if(r.carouselItems=e,null===b){var n=N.find("li");b=0===n.length?N[0].getBoundingClientRect().width:n[0].getBoundingClientRect().width,y.css("width",b+"px")}},!0),r.$watch("totalIndex",function(){g(!E),v(),!E&&c&&m(),E=!0}),angular.isDefined(u.rnCarouselIndicator)){var k=e("<div id='"+C+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);y.append(k)}var F=function(){return r.carouselItems.length};a.bind(N,{start:function(e){0===B&&(B=1,$=e.x)},move:function(e){if(0!==B){var n=e.x-$;if(1===B&&0!==n)B=2,S=w;else if(2===B){var a=F(),t=1;(0===r.totalIndex&&e.x>$||r.totalIndex===a-1&&$>e.x)&&(t=3),w=S+n/t,N.css(p(w)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){if(B>0){B=0;var n=F(),a=S>w?1:-1,t=Math.min(Math.max(0,r.totalIndex+a),n-1),i=e.x-$;b*M>=Math.abs(i)&&(t=r.totalIndex);var u=r.totalIndex!==t;u?r.$apply(function(){x(t)}):r.$apply(function(){g()})}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);